```
Date : 2020 - 02 - 28

Author : Soler HO

Book :C++ Primer Plus

Chapter : FOUR
 
Description : 使用new分配和delete释放内存
```

## 指针和数字问题

指针不是整型，计算机通常把地址当作整数来处理。

概念上，指针和整数是不同的类型。

整数是可以执行加、减、乘、除等运算的数字。

指针描述的是 位置，所以地址相乘没有意义。

## 使用new分配内存
指针在`运行阶段` 分配未命名的内存以存储值。然后使用内存来访问内存。

C语言中，使用 **库函数malloc()**来分配内存。C++中使用 ———— new运算符。


## 要注意使用delete进行内存的释放
 
需要内存时，直接使用new来请求，这是内存管理数据包的一个方面。

如果使用了delete运算符，使得在使用完内存后，能够将其归还给内存池，这是有效使用内存的关键。

使用delete时，后面要加上指向内存块的指针。
```
int * ps = new int; // 使用new进行内存分配
 ...
delete ps; // 使用delete进行内存的释放
```

#### 注意点：

1.使用delete释放ps的内存，但是不会删除指针ps本身。

2.只能用delete来释放使用new分配的内存，但是如果是空的指针使用delete是安全的。

**使用delete的关键**：用于new分配的内存。不是要使用于new的指针，而是用于new的地址。

警告：不能创建两个指向同一个内存块的指针。会增加错误地删除同一个内存块两次的可能性。

## 使用new创建动态数组

C++中，创建动态数组，只需要将数组的元素类型和元素数目告诉new即可。必须在类型名后面加上方括号，其中包含了元素数目。

例子：
```
int * psome =new int[10]; // 创建10个int元素的数组
```
new运算符会返回第一个元素的地址

如果使用完new分配的内存，使用delete进行内存的释放。
```
delete [] psome; // 进行内存的释放
```
delete和指针直接的方括号告诉程序，应释放整个数组，不仅仅是指针指向的元素。

delete中的方括号的有无取决于使用new时的方括号有无。

#### 为数组分配内存的通用格式
```
Type_name *pointer_name = new Type_name[num_element];
```
例子：
```
int * psome = new int[10]; // 10个int值的内存块
```

对于指针数组的使用，直接可以按照普通数组的使用即可。

## 使用new和delete时，要遵循的规则
- 不要使用delete来释放不是new分配的内存。
- 不要使用delete释放同一个内存块两次。
- 如果使用`new[]`为`数组`分配内存时，则应使用`delete[] `来释放。
- 如果使用new[]为一个`实体`分配内存，则应使用`delete（没有方括号）`来释放。
- 对空指针使用delete时很安全。

